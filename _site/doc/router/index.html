
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>
      
        Router - 
      
      Goku
    </title>
    <meta name="description" content="">
    <meta name="author" content="QLeelulu">

    <link rel="stylesheet" href="/assets/themes/modernist/stylesheets/styles.css">
    <link rel="stylesheet" href="/assets/themes/modernist/stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>

  <div class="outer">
    <div class="sidebar">
      <ul class="posts">
        <li><a href="/">About</a></li>
        <li><a href="/doc/intro">Intro</a></li>
        <li><a href="/doc/router">Router</a></li>
        <li><a href="/doc/controller--action">Controller & Action</a></li>
        <li><a href="/doc/view">View & ViewEngine</a></li>
        <li><a href="/doc/template">Template</a></li>
        <li><a href="/doc/form-validation">Form Validation</a></li>
        <li><a href="/doc/filter">Filter</a></li>
        <li><a href="/doc/middleware">Middleware</a></li>
        <li><a href="/doc/db">DB</a></li>
        <li><a href="/doc/httpcontext">HttpContext</a></li>
        <li><a href="/doc/log">Log</a></li>
      </ul>
    </div>

    <div class="wrapper">
      <header>
        <h1><a class="brand" href="/">Goku</a></h1>
        <p>Golang Web Mvc Framework</p>
        <p class="view"><a href="http://github.com/qleelulu/goku">View the Project on GitHub <small>qleelulu/goku</small></a></p>
        <ul>
          <li><a href="https://github.com/qleelulu/goku/zipballmus/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/qleelulu/goku/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="http://github.com/qleelulu/goku">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        
  <h1>
    Router 
    
  </h1>

<p>Routes map incoming requests for URLs to a Controller and Action. They also are used to construct an URL to a Controller/Action.</p>

<h2 id='map_route'>Map Route</h2>

<p>You can map route by this two ways:</p>
<div class='highlight'><pre><code class='go'><span class='kd'>var</span> <span class='nx'>Routes</span> <span class='p'>[]</span><span class='o'>*</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span> <span class='p'>=</span> <span class='p'>[]</span><span class='o'>*</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
    <span class='o'>&amp;</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
        <span class='nx'>Name</span><span class='p'>:</span>     <span class='s'>&quot;static&quot;</span><span class='p'>,</span>
        <span class='nx'>IsStatic</span><span class='p'>:</span> <span class='kc'>true</span><span class='p'>,</span>
        <span class='nx'>Pattern</span><span class='p'>:</span>  <span class='s'>&quot;/public/(.*)&quot;</span><span class='p'>,</span>
    <span class='p'>},</span>
    <span class='o'>&amp;</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
        <span class='nx'>Name</span><span class='p'>:</span>       <span class='s'>&quot;edit&quot;</span><span class='p'>,</span>
        <span class='nx'>Pattern</span><span class='p'>:</span>    <span class='s'>&quot;/{controller}/{id}/{action}&quot;</span><span class='p'>,</span>
        <span class='nx'>Default</span><span class='p'>:</span>    <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;action&quot;</span><span class='p'>:</span> <span class='s'>&quot;edit&quot;</span><span class='p'>},</span>
        <span class='nx'>Constraint</span><span class='p'>:</span> <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;id&quot;</span><span class='p'>:</span> <span class='s'>&quot;\\d+&quot;</span><span class='p'>},</span>
    <span class='p'>},</span>
    <span class='o'>&amp;</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
        <span class='nx'>Name</span><span class='p'>:</span>    <span class='s'>&quot;default&quot;</span><span class='p'>,</span>
        <span class='nx'>Pattern</span><span class='p'>:</span> <span class='s'>&quot;/{controller}/{action}&quot;</span><span class='p'>,</span>
        <span class='nx'>Default</span><span class='p'>:</span> <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;controller&quot;</span><span class='p'>:</span> <span class='s'>&quot;todo&quot;</span><span class='p'>,</span> <span class='s'>&quot;action&quot;</span><span class='p'>:</span> <span class='s'>&quot;index&quot;</span><span class='p'>},</span>
    <span class='p'>},</span>
<span class='p'>}</span>
<span class='c1'>// create server with the rules</span>
<span class='nx'>rt</span> <span class='o'>:=</span> <span class='o'>&amp;</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>RouteTable</span><span class='p'>{</span><span class='nx'>Routes</span><span class='p'>:</span> <span class='nx'>todo</span><span class='p'>.</span><span class='nx'>Routes</span><span class='p'>}</span>
<span class='nx'>s</span> <span class='o'>:=</span> <span class='nx'>goku</span><span class='p'>.</span><span class='nx'>CreateServer</span><span class='p'>(</span><span class='nx'>rt</span><span class='p'>,</span> <span class='kc'>nil</span><span class='p'>,</span> <span class='kc'>nil</span><span class='p'>)</span>
<span class='nx'>log</span><span class='p'>.</span><span class='nx'>Fatal</span><span class='p'>(</span><span class='nx'>s</span><span class='p'>.</span><span class='nx'>ListenAndServe</span><span class='p'>())</span>
</code></pre></div>
<p>or</p>
<div class='highlight'><pre><code class='go'><span class='nx'>rt</span> <span class='o'>:=</span> <span class='nb'>new</span><span class='p'>(</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>RouteTable</span><span class='p'>)</span>
<span class='nx'>rt</span><span class='p'>.</span><span class='nx'>Static</span><span class='p'>(</span><span class='s'>&quot;staticFile&quot;</span><span class='p'>,</span> <span class='s'>&quot;/static/(.*)&quot;</span><span class='p'>)</span>
<span class='nx'>rt</span><span class='p'>.</span><span class='nx'>Map</span><span class='p'>(</span>
    <span class='s'>&quot;blog-page&quot;</span><span class='p'>,</span> <span class='c1'>// route name</span>
    <span class='s'>&quot;/blog/p/{page}&quot;</span><span class='p'>,</span> <span class='c1'>// pattern</span>
    <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;controller&quot;</span><span class='p'>:</span> <span class='s'>&quot;blog&quot;</span><span class='p'>,</span> <span class='s'>&quot;action&quot;</span><span class='p'>:</span> <span class='s'>&quot;page&quot;</span><span class='p'>,</span> <span class='s'>&quot;page&quot;</span><span class='p'>:</span> <span class='s'>&quot;0&quot;</span><span class='p'>},</span> <span class='c1'>// default</span>
    <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;page&quot;</span><span class='p'>:</span> <span class='s'>&quot;\\d+&quot;</span><span class='p'>}</span> <span class='c1'>// constraint</span>
<span class='p'>)</span>
<span class='nx'>rt</span><span class='p'>.</span><span class='nx'>Map</span><span class='p'>(</span>
    <span class='s'>&quot;default&quot;</span><span class='p'>,</span> <span class='c1'>// route name</span>
    <span class='s'>&quot;/{controller}/{action}&quot;</span><span class='p'>,</span> <span class='c1'>// pattern</span>
    <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;controller&quot;</span><span class='p'>:</span> <span class='s'>&quot;home&quot;</span><span class='p'>,</span> <span class='s'>&quot;action&quot;</span><span class='p'>:</span> <span class='s'>&quot;index&quot;</span><span class='p'>},</span> <span class='c1'>// default</span>
<span class='p'>)</span>
</code></pre></div>
<h2 id='static_file_route'>Static File Route</h2>

<p>When a route set <code>IsStatic</code> to <code>true</code>, if a url matched this route, the request will process as static file. Such as JS, CSS file.</p>

<p>In production environment, i suggest you proxy the static files with Nginx.</p>

<h2 id='url_patterns'>URL Patterns</h2>

<p>A URL pattern can contain literal values and variable placeholders (referred to as URL parameters). The literals and placeholders are located in segments of the URL which are delimited by the slash (/) character.</p>

<p>When a request is made, the URL is parsed into segments and placeholders, and the variable values are provided to the request handler. This process is similar to the way the data in query strings is parsed and passed to the request handler. In both cases variable information is included in the URL and passed to the handler in the form of key-value pairs. For query strings both the keys and the values are in the URL. For routes, the keys are the placeholder names defined in the URL pattern, and only the values are in the URL.</p>

<p>In a URL pattern, you define placeholders by enclosing them in braces ( { and } ). You can define more than one placeholder in a segment, but they must be separated by a literal value. For example, <code>{language}-{country}/{action}</code> is a valid route pattern. However, <code>{language}{country}/{action}</code> is not a valid pattern, because there is no literal value or delimiter between the placeholders. Therefore, routing cannot determine where to separate the value for the language placeholder from the value for the country placeholder.</p>

<p>The following table shows valid route patterns and examples of URL requests that match the patterns.</p>
<table><thead><tr><th><em>Route definition</em></th><th><em>Example of matching URL</em></th></tr></thead><tbody><tr><td style='text-align: left;'>{controller}/{action}/{id}</td><td style='text-align: left;'>/Products/show/beverages</td>
</tr><tr><td style='text-align: left;'>{table}/Details.html</td><td style='text-align: left;'>/Products/Details.html</td>
</tr><tr><td style='text-align: left;'>blog/{action}/{entry}</td><td style='text-align: left;'>/blog/show/123</td>
</tr><tr><td style='text-align: left;'>{reporttype}/{year}/{month}/{day}</td><td style='text-align: left;'>/sales/2008/1/5</td>
</tr><tr><td style='text-align: left;'>{locale}/{action}</td><td style='text-align: left;'>/US/show</td>
</tr><tr><td style='text-align: left;'>{language}-{country}/{action}</td><td style='text-align: left;'>/en-US/show</td>
</tr></tbody></table>
<h2 id='setting_default_values_for_url_parameters'>Setting Default Values for URL Parameters</h2>

<p>When you define a route, you can assign a default value for a parameter. The default value is used if a value for that parameter is not included in the URL. You set default values for a route by assigning a map to the <code>Defaults</code> property of the <code>Route</code> struct. The following example shows how to add a route that has default values, by using the MapPageRoute(String, String, String, Boolean, RouteValueDictionary) method.</p>
<div class='highlight'><pre><code class='go'><span class='kd'>var</span> <span class='nx'>Routes</span> <span class='p'>[]</span><span class='o'>*</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span> <span class='p'>=</span> <span class='p'>[]</span><span class='o'>*</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
    <span class='o'>&amp;</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
        <span class='nx'>Name</span><span class='p'>:</span>    <span class='s'>&quot;default&quot;</span><span class='p'>,</span>
        <span class='nx'>Pattern</span><span class='p'>:</span> <span class='s'>&quot;Category/{action}/{categoryName}&quot;</span><span class='p'>,</span>
        <span class='nx'>Default</span><span class='p'>:</span> <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span>
            <span class='s'>&quot;controller&quot;</span><span class='p'>:</span> <span class='s'>&quot;category&quot;</span><span class='p'>,</span> <span class='s'>&quot;action&quot;</span><span class='p'>:</span> <span class='s'>&quot;show&quot;</span><span class='p'>,</span> <span class='s'>&quot;categoryName&quot;</span><span class='p'>:</span><span class='s'>&quot;food&quot;</span>
        <span class='p'>},</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>When goku routing handles a URL request, the route definition shown in the example (with default values of food for categoryName and show for action) produces the results that are listed in the following table.</p>
<table><thead><tr><th>URL</th><th>Parameter values</th></tr></thead><tbody><tr><td style='text-align: left;'>/Category</td><td style='text-align: left;'>action = &#8220;show&#8221; (default value) <br /> categoryName = &#8220;food&#8221; (default value)</td>
</tr><tr><td style='text-align: left;'>/Category/add</td><td style='text-align: left;'>action = &#8220;add&#8221; <br /> categoryName = &#8220;food&#8221; (default value)</td>
</tr><tr><td style='text-align: left;'>/Category/add/beverages</td><td style='text-align: left;'>action = &#8220;add&#8221; <br /> categoryName= &#8220;beverages&#8221;</td>
</tr></tbody></table>
<h2 id='adding_constraints_to_routes'>Adding Constraints to Routes</h2>

<p>In addition to matching a URL request to a route definition by the number of parameters in the URL, you can specify that values in the parameters meet certain constraints. If a URL contains values that are outside the constraints for a route, that route is not used to handle the request. You add constraints to make sure that the URL parameters contain values that will work in your application.</p>

<p>Constraints are defined by using regular expressions. You add constraints for a route by assigning a map to the <code>Constraint</code> property of the <code>Route</code> struct, or add by <code>RouteTable.Map()</code></p>
<div class='highlight'><pre><code class='go'><span class='kd'>var</span> <span class='nx'>Routes</span> <span class='p'>[]</span><span class='o'>*</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span> <span class='p'>=</span> <span class='p'>[]</span><span class='o'>*</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
    <span class='o'>&amp;</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>Route</span><span class='p'>{</span>
        <span class='nx'>Name</span><span class='p'>:</span>       <span class='s'>&quot;post-list&quot;</span><span class='p'>,</span>
        <span class='nx'>Pattern</span><span class='p'>:</span>    <span class='s'>&quot;whatever/{locale}/{year}&quot;</span><span class='p'>,</span>
        <span class='nx'>Constraint</span><span class='p'>:</span> <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span>
            <span class='s'>&quot;locale&quot;</span><span class='p'>:</span> <span class='s'>&quot;[a-z]{2}-[a-z]{2}&quot;</span><span class='p'>,</span> <span class='s'>&quot;year&quot;</span><span class='p'>:</span> <span class='s'>&quot;\\d{4}&quot;</span>
        <span class='p'>},</span>
    <span class='p'>},</span>
<span class='p'>}</span>

<span class='c1'>// or</span>

<span class='nx'>rt</span> <span class='o'>:=</span> <span class='nb'>new</span><span class='p'>(</span><span class='nx'>goku</span><span class='p'>.</span><span class='nx'>RouteTable</span><span class='p'>)</span>
<span class='nx'>rt</span><span class='p'>.</span><span class='nx'>Map</span><span class='p'>(</span>
    <span class='s'>&quot;post-list&quot;</span><span class='p'>,</span> <span class='c1'>// route name</span>
    <span class='s'>&quot;whatever/{locale}/{year}&quot;</span><span class='p'>,</span> <span class='c1'>// pattern</span>
    <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span><span class='s'>&quot;controller&quot;</span><span class='p'>:</span> <span class='s'>&quot;post&quot;</span><span class='p'>,</span> <span class='s'>&quot;action&quot;</span><span class='p'>:</span> <span class='s'>&quot;show&quot;</span><span class='p'>},</span> <span class='c1'>// default</span>
    <span class='kd'>map</span><span class='p'>[</span><span class='kt'>string</span><span class='p'>]</span><span class='kt'>string</span><span class='p'>{</span> <span class='c1'>// constraint</span>
        <span class='s'>&quot;locale&quot;</span><span class='p'>:</span> <span class='s'>&quot;[a-z]{2}-[a-z]{2}&quot;</span><span class='p'>,</span> <span class='s'>&quot;year&quot;</span><span class='p'>:</span> <span class='s'>&quot;\\d{4}&quot;</span>
    <span class='p'>}</span>
<span class='p'>)</span>
</code></pre></div>
<p>When routing handles a URL request, the route definition shown in the previous example produces the results that are listed in the following table.</p>
<table><thead><tr><th>URL</th><th>Result</th></tr></thead><tbody><tr><td style='text-align: left;'>/en-us</td><td style='text-align: left;'>No match. <br /> Both locale and year are required.</td>
</tr><tr><td style='text-align: left;'>/en-us/08</td><td style='text-align: left;'>No match. <br /> The constraint on year requires 4 digits.</td>
</tr><tr><td style='text-align: left;'>/en-us/2008</td><td style='text-align: left;'>locale = &#8220;en-us&#8221; <br /> year = &#8220;2008&#8221;</td>
</tr></tbody></table>
<p>If default value not set, that mean the parameter is required.</p>

<h2 id='route_data'>Route Data</h2>

<p>For the Pattern <code>Category/{action}/{categoryName}</code>, and a URL <code>/Category/add/beverages</code>, you can get the <code>categoryName</code> parameter in the controller action by HttpContext:</p>
<div class='highlight'><pre><code class='go'><span class='c1'>// ctx is HttpContext</span>
<span class='nx'>categoryName</span> <span class='o'>:=</span> <span class='nx'>ctx</span><span class='p'>.</span><span class='nx'>RouteData</span><span class='p'>.</span><span class='nx'>Params</span><span class='p'>[</span><span class='s'>&quot;categoryName&quot;</span><span class='p'>]</span>
<span class='c1'>// categoryName == beverages</span>
</code></pre></div>
<h2 id='todo'>TODO</h2>

<ul>
<li>Construct URLs from Routes</li>
</ul>


      </section>
    </div>

  </div>

    <footer>
      <p>Project maintained by <a href="https://www.github.com/QLeelulu">QLeelulu</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <script src="/assets/themes/modernist/javascripts/scale.fix.js"></script>
  </body>
</html>
